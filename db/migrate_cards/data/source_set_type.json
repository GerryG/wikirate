{
  "url": "http://localhost:3000/export.json",
  "timestamp": "2016-01-17 17:00:07 +0000",
  "card": {
    "name": "export",
    "type": "Pointer",
    "content": "[[source+*type+*structure]]\n[[script: new source page]]",
    "value": [
      {
        "name": "Source+*type+*structure",
        "type": "HTML",
        "content": "<div class=\"col-md-12 new-source-widget\">\r\n  <div class=\"row\">\r\n  <div class=\"new-source-tab\">\r\n    <ul id=\"myTab\" class=\"nav nav-pills\" role=\"tablist\">\r\n      <li role=\"presentation\" class=\"active\">\r\n        <a href=\"#url\" id=\"url-tab\" role=\"tab\" data-source-type='Link' data-toggle=\"tab\" aria-controls=\"url\" aria-expanded=\"true\"><i class=\"fa fa-globe\"></i> URL</a>\r\n      </li>\r\n      <li role=\"presentation\" class=\"\">\r\n        <a href=\"#file\" role=\"tab\" id=\"file-tab\" data-toggle=\"tab\" data-source-type='File' aria-controls=\"file\" aria-expanded=\"false\"><i class=\"fa fa-upload\"></i> File</a>\r\n      </li>\r\n      <li role=\"presentation\" class=\"\">\r\n        <a href=\"#text\" role=\"tab\" id=\"text-tab\" data-toggle=\"tab\" data-source-type='Text' aria-controls=\"text\" aria-expanded=\"false\"><i class=\"fa fa-pencil\"></i> Report</a>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n\r\n  <div id=\"myTabContent\" class=\"tab-content\">\r\n    <div role=\"tabpanel\" class=\"tab-pane fade active in\" id=\"url\" aria-labelledby=\"url-tab\">\r\n      {{+Link|titled; title:URL}}\r\n      <button type=\"button\" class=\"btn btn-default btn-xs\" id=\"suggest_button\">Suggest Title and Description</button>\r\n    </div>\r\n    <div role=\"tabpanel\" class=\"tab-pane fade\" id=\"file\" aria-labelledby=\"file-tab\">\r\n      {{+File|titled; title:File}}\r\n       \r\n    </div>\r\n    <div role=\"tabpanel\" class=\"tab-pane fade\" id=\"text\" aria-labelledby=\"text-tab\">\r\n      {{+Text|titled; title:Text}}\r\n    </div>\r\n  </div>\r\n  </div>\r\n  <div class=\"row\">\r\n    <div class=\"first-meta tab-content\">\r\n      {{+Title|titled; title:Title}} {{+Description|titled;title:Description}}\r\n      <div class=\"row-data first-meta\" >\r\n        <a id=\"add-company-and-topic\" href=\"#\">\r\n          <i class=\"fa fa-building-o\"></i>Add Company\r\n        </a>\r\n      </div>\r\n      \r\n      <div id=\"company-topic-meta\" style=\"display:none;\">\r\n        {{+Companies|titled; title:Companies|link}}\r\n      </div>\r\n      \r\n      <div class=\"row-data first-meta\" >\r\n       <a href=\"#\" id=\"add-tags-other\">\r\n          <i class=\"fa fa-tag\"></i>Add Topic, Date and other\r\n        </a>\r\n      </div>\r\n      \r\n      \r\n      <div id=\"tag-date-others-meta\" style=\"display:none;\">\r\n        {{+Topics|titled; title:Topics|link}} {{#+Tags|titled;title:Tags; item:link}} {{+Date|titled;title:Date}} {{+Website|titled;title:Website|link}}\r\n      </div>\r\n    \r\n    </div>\r\n  </div>\r\n  <div style='display:none;'>{{+*source type}}</div>\r\n</div>"
      },
      {
        "name": "script: new source page",
        "type": "CoffeeScript",
        "content": "wagn.slotReady (slot) ->\n  if slot.hasClass('new-view') && slot.hasClass('TYPE-source')\n    # bind listener to the tab anchor\n    slot.find('#myTab').find(\"a\").click (e) ->\n      # update the source type\n      source_type = $(this).data('source-type')\n      source_type_subcard = slot.find(\"#card_subcards___source_type_content\")\n      source_type_subcard.val(\"[[\"+source_type+\"]]\")\n      source_type_subcard.siblings(\"ul\").find(\"input[value=\"+source_type+\"]\").prop(\"checked\", true)\n\n\r\n$(window).ready ->\r\n\r\n  ###\r\n    To autopopulate the meta data in the input fields in new source page\r\n  ###\r\n\r\n  #$('#card_subcards__File_attach').change ->\r\n    #$('.first-meta').fadeIn()\r\n    #return\r\n  #$('#text-tab').click ->\r\n    #plus_text_tinymce_eidtor = null\r\n    #i = 0\r\n    #while i < tinymce.editors.length\r\n      #if tinymce.editors[i].editorId.indexOf('+text') > -1\r\n        #plus_text_tinymce_eidtor = tinymce.editors[i]\r\n      #i++\r\n    #if plus_text_tinymce_eidtor\r\n      #plus_text_tinymce_eidtor.onKeyUp.add (ed, l) ->\r\n        #if !$('.first-meta').is(':visible')\r\n          #$('.first-meta').fadeIn()\r\n        #return\r\n    #return\r\n  $('#add-company-and-topic').click (e) ->\r\n    e.preventDefault()\r\n    $('#company-topic-meta').fadeIn()\r\n    $('#add-company-and-topic').hide()\r\n    return\r\n  $('#add-tags-other').click (e) ->\r\n    e.preventDefault()\r\n    $('#tag-date-others-meta').fadeIn()\r\n    $('#add-tags-other').hide()\r\n    return\r\n    \r\n  # update source type\r\n  \r\n  \r\n  $('#suggest_button').on 'click', ->\r\n    sourceElement = $('#card_subcards__Link_content')\r\n    errorDiv = '<div class=\"sourceErrorMsg\"> Invalid URL. (Valid URL looks like \"http://www.example.com\")</div>'\r\n    if !sourceElement.val().match(/^http/)\r\n      if sourceElement.siblings('.sourceErrorMsg').length > 0 then '' else sourceElement.after(errorDiv)\r\n      return false\r\n    else\r\n      sourceElement.siblings('.sourceErrorMsg').remove()\r\n    if $(this).parents(\".modal.fade\").length >= 1\r\n      return false\r\n    else\r\n      loaderHTML = '<span class=\\'addSourceLoader\\'>Loading Metadata...</span>'\r\n      if sourceElement.siblings('.addSourceLoader').length > 0 then '' else sourceElement.after(loaderHTML)\r\n    $('#loading').fadeIn()\r\n    titleElement = $('#card_subcards__Title_content')\r\n    websiteElement = $('#card_subcards__Website_content').siblings('.pointer-list-ul').find('.pointer-item-text')\r\n    url = sourceElement.val()\r\n    metaReqObj = {}\r\n    metaReqObj.view = 'metadata'\r\n    metaReqObj.url = url\r\n    $.ajax(wagn.rootPath + '/source.json?' + $.param(metaReqObj)).done((response) ->\r\n      titleElement.val response.title\r\n      websiteElement.focusin().val(response.website).focusout()\r\n      id = $('.new-view.TYPE-source .RIGHT-description').find('textarea:first').attr('id')\r\n      tinyMCE.get(id).setContent response.description\r\n      sourceElement.siblings('.addSourceLoader').remove()\r\n      return\r\n    ).error((errorMsg) ->\r\n      #Need to handle error\r\n      return\r\n    ).complete (data) ->\r\n      $('#loading').hide()\r\n      $('.first-meta').fadeIn()\r\n      return\r\n    return\r\n  return\r\n"
      }
    ]
  }
}